<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>微信小程序业务 | 前端小札</title>
    <meta name="description" content="">
    <script>
      var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?8092fab2f2adfc7938ba5b8885aef5b4";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
      })();
    </script>
    <link rel="icon" href="/syy-notes/favicon.ico">
    <link rel="manifest" href="/syy-notes/manifest.json">
    <link rel="apple-touch-icon" href="/syy-notes/favicon.ico">
    <link rel="mask-icon" href="/syy-notes/favicon.ico" color="#3eaf7c">
    <meta name="description" content="前端常用知识、踩坑记录等">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/favicon.ico">
    <meta name="msapplication-TileColor" content="#000000">
    <link rel="preload" href="/syy-notes/assets/css/0.styles.fa044e56.css" as="style"><link rel="preload" href="/syy-notes/assets/js/app.21b87ce3.js" as="script"><link rel="preload" href="/syy-notes/assets/js/2.866f3439.js" as="script"><link rel="preload" href="/syy-notes/assets/js/4.18169195.js" as="script"><link rel="preload" href="/syy-notes/assets/js/11.801c2fb3.js" as="script"><link rel="preload" href="/syy-notes/assets/js/5.9e51e156.js" as="script"><link rel="prefetch" href="/syy-notes/assets/js/10.e8b346da.js"><link rel="prefetch" href="/syy-notes/assets/js/12.9da13134.js"><link rel="prefetch" href="/syy-notes/assets/js/13.5b6e0387.js"><link rel="prefetch" href="/syy-notes/assets/js/14.d945031c.js"><link rel="prefetch" href="/syy-notes/assets/js/15.e678d0a3.js"><link rel="prefetch" href="/syy-notes/assets/js/16.4a62961a.js"><link rel="prefetch" href="/syy-notes/assets/js/17.c8939ee3.js"><link rel="prefetch" href="/syy-notes/assets/js/18.78b87357.js"><link rel="prefetch" href="/syy-notes/assets/js/19.9c12f60c.js"><link rel="prefetch" href="/syy-notes/assets/js/20.186306ec.js"><link rel="prefetch" href="/syy-notes/assets/js/21.957c3bcc.js"><link rel="prefetch" href="/syy-notes/assets/js/22.b53ba1ac.js"><link rel="prefetch" href="/syy-notes/assets/js/23.6f06d5d7.js"><link rel="prefetch" href="/syy-notes/assets/js/24.6eb6b29a.js"><link rel="prefetch" href="/syy-notes/assets/js/25.3f528f60.js"><link rel="prefetch" href="/syy-notes/assets/js/26.44b5dd6d.js"><link rel="prefetch" href="/syy-notes/assets/js/27.5740836e.js"><link rel="prefetch" href="/syy-notes/assets/js/28.0e24986e.js"><link rel="prefetch" href="/syy-notes/assets/js/29.e459066d.js"><link rel="prefetch" href="/syy-notes/assets/js/3.9273ff26.js"><link rel="prefetch" href="/syy-notes/assets/js/30.9fc5ee96.js"><link rel="prefetch" href="/syy-notes/assets/js/31.08ae3514.js"><link rel="prefetch" href="/syy-notes/assets/js/32.648efda3.js"><link rel="prefetch" href="/syy-notes/assets/js/33.9673cd14.js"><link rel="prefetch" href="/syy-notes/assets/js/34.3edf3855.js"><link rel="prefetch" href="/syy-notes/assets/js/35.4eb6a9e1.js"><link rel="prefetch" href="/syy-notes/assets/js/36.79f42700.js"><link rel="prefetch" href="/syy-notes/assets/js/37.9142401c.js"><link rel="prefetch" href="/syy-notes/assets/js/38.20329375.js"><link rel="prefetch" href="/syy-notes/assets/js/39.4996f640.js"><link rel="prefetch" href="/syy-notes/assets/js/40.43001f29.js"><link rel="prefetch" href="/syy-notes/assets/js/41.c7adfbbe.js"><link rel="prefetch" href="/syy-notes/assets/js/42.06783a95.js"><link rel="prefetch" href="/syy-notes/assets/js/43.7b9cbb4d.js"><link rel="prefetch" href="/syy-notes/assets/js/6.c7107f35.js"><link rel="prefetch" href="/syy-notes/assets/js/7.8c0de395.js"><link rel="prefetch" href="/syy-notes/assets/js/8.dd2136db.js"><link rel="prefetch" href="/syy-notes/assets/js/9.409b2fb9.js">
    <link rel="stylesheet" href="/syy-notes/assets/css/0.styles.fa044e56.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/syy-notes/" class="home-link router-link-active"><!----> <span class="site-name">前端小札</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工作项目" class="dropdown-title"><span class="title">工作项目</span> <span class="arrow down"></span></button> <button type="button" aria-label="工作项目" class="mobile-dropdown-title"><span class="title">工作项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="http://admin.yuke520.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  后台管理系统
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="/syy-notes/uniapp/yukexcx.html" class="nav-link">
  裕客商城小程序
</a></li></ul></div></div><div class="nav-item"><a href="https://yu-nan.gitee.io/suui" target="_blank" rel="noopener noreferrer" class="nav-link external">
   suUI 
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://www.syy123.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  言叶之庭
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关于" class="dropdown-title"><span class="title">关于</span> <span class="arrow down"></span></button> <button type="button" aria-label="关于" class="mobile-dropdown-title"><span class="title">关于</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/suyanye123/syy-notes" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="/syy-notes/introduce/" class="nav-link">
  关于我
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工作项目" class="dropdown-title"><span class="title">工作项目</span> <span class="arrow down"></span></button> <button type="button" aria-label="工作项目" class="mobile-dropdown-title"><span class="title">工作项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="http://admin.yuke520.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  后台管理系统
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="/syy-notes/uniapp/yukexcx.html" class="nav-link">
  裕客商城小程序
</a></li></ul></div></div><div class="nav-item"><a href="https://yu-nan.gitee.io/suui" target="_blank" rel="noopener noreferrer" class="nav-link external">
   suUI 
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://www.syy123.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  言叶之庭
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关于" class="dropdown-title"><span class="title">关于</span> <span class="arrow down"></span></button> <button type="button" aria-label="关于" class="mobile-dropdown-title"><span class="title">关于</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/suyanye123/syy-notes" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="/syy-notes/introduce/" class="nav-link">
  关于我
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/syy-notes/mytools/" class="sidebar-link">网页工具</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/syy-notes/demo/" class="sidebar-heading clickable"><span>我的项目</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/syy-notes/uniapp/" class="sidebar-heading clickable router-link-active open"><span>uni-app</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/syy-notes/uniapp/miniProgram.html" aria-current="page" class="active sidebar-link">微信小程序业务</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/syy-notes/uniapp/miniProgram.html#一、微信授权登录全流程" class="sidebar-link">一、微信授权登录全流程</a></li><li class="sidebar-sub-header"><a href="/syy-notes/uniapp/miniProgram.html#二、微信支付全流程" class="sidebar-link">二、微信支付全流程</a></li><li class="sidebar-sub-header"><a href="/syy-notes/uniapp/miniProgram.html#三、动态计算显示高度" class="sidebar-link">三、动态计算显示高度</a></li><li class="sidebar-sub-header"><a href="/syy-notes/uniapp/miniProgram.html#四、scroll吸附贴顶效果" class="sidebar-link">四、scroll吸附贴顶效果</a></li><li class="sidebar-sub-header"><a href="/syy-notes/uniapp/miniProgram.html#五、小程序生成海报图片并保存至本地" class="sidebar-link">五、小程序生成海报图片并保存至本地</a></li></ul></li></ul></section></li><li><a href="/syy-notes/git/" class="sidebar-link">Git</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/syy-notes/webGL/" class="sidebar-heading clickable"><span>WebGL</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/syy-notes/utils/" class="sidebar-heading clickable"><span>utils</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/syy-notes/freeTalk/" class="sidebar-heading clickable"><span>写点东西</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="微信小程序业务"><a href="#微信小程序业务" class="header-anchor">#</a> 微信小程序业务</h1> <h6 id="本文为简素言也原创手打-转载请注明出处哦"><a href="#本文为简素言也原创手打-转载请注明出处哦" class="header-anchor">#</a> ——本文为简素言也原创手打，转载请注明出处哦——</h6> <h2 id="一、微信授权登录全流程"><a href="#一、微信授权登录全流程" class="header-anchor">#</a> 一、微信授权登录全流程</h2> <p>1.定位授权</p> <p>2.个人信息授权</p> <ol start="3"><li></li></ol> <h2 id="二、微信支付全流程"><a href="#二、微信支付全流程" class="header-anchor">#</a> 二、微信支付全流程</h2> <p>微信公众号服务号、公众号商城、包括小程序，都是用的JSAPI支付方式</p> <p><a href="https://pay.weixin.qq.com/wiki/doc/apiv3/apis/chapter3_1_4.shtml" target="_blank" rel="noopener noreferrer">JSAPI官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="_1-开发前准备"><a href="#_1-开发前准备" class="header-anchor">#</a> 1.开发前准备</h4> <h5 id="_1-在-微信商户平台-开通微信商户-该步骤较为麻烦"><a href="#_1-在-微信商户平台-开通微信商户-该步骤较为麻烦" class="header-anchor">#</a> （1）在<a href="https://pay.weixin.qq.com/index.php/core/home/login?return_url=%2F" target="_blank" rel="noopener noreferrer"> 微信商户平台 <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>开通微信商户（该步骤较为麻烦）</h5> <p>获取商户号MCH_ID和设置商户API密钥，申请API证书</p> <p>如果需要退款，还需要设置APIv3密钥</p> <h5 id="_2-微信公众平台-小程序提交认证"><a href="#_2-微信公众平台-小程序提交认证" class="header-anchor">#</a> （2）微信公众平台，小程序提交认证</h5> <p>需填写各种信息，认证务必选择企业类型，提供企业经营证书及社会信用码等等，需要300元费用，认证很快</p> <h5 id="_3-开通小程序支付功能"><a href="#_3-开通小程序支付功能" class="header-anchor">#</a> （3）开通小程序支付功能</h5> <p>将小程序的appid绑定到第一步开通的商户号上</p> <h4 id="_2-代码实现"><a href="#_2-代码实现" class="header-anchor">#</a> 2.代码实现</h4> <h5 id="_1-jsapi统一下单"><a href="#_1-jsapi统一下单" class="header-anchor">#</a> （1）JSAPI统一下单</h5> <p>将下单的商品信息和<code>openId</code> 发给后端，</p> <p>后端 通过统一下单接口，进行第一次签名，需要的参数如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//APPID：小程序的 AppID</span>
<span class="token comment">//MCH_ID：商户号</span>
<span class="token comment">//KEY：商户支付API密钥</span>
<span class="token comment">//APPSECRET：小程序开发者密钥</span>
</code></pre></div><p>如果在统一下单的时候，不填写sign_type为MD5,则会默认使用HMAC-SHA256加密，这个是我们要排的第一个坑。</p> <p>微信后台接到统一下单参数后，会生成一个商户订单，并将预下单id（prepay_id ）返回给后端</p> <h5 id="_2-二次签名"><a href="#_2-二次签名" class="header-anchor">#</a> （2）二次签名</h5> <p>后端 根据微信返回值，通过微信提供的算法，进行二次签名</p> <p><a href="https://pay.weixin.qq.com/wiki/doc/api/wxa/wxa_api.php?chapter=4_3" target="_blank" rel="noopener noreferrer">签名算法<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>将生成的二次签名和其他参数返回给前端</p> <h5 id="_3-前端通过uni-request调起微信支付接口-代码如下"><a href="#_3-前端通过uni-request调起微信支付接口-代码如下" class="header-anchor">#</a> （3）前端通过uni.request调起微信支付接口，代码如下</h5> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 唤起微信支付</span>
uni<span class="token punctuation">.</span><span class="token function">requestPayment</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  provider<span class="token operator">:</span> <span class="token string">&quot;wxpay&quot;</span><span class="token punctuation">,</span>
  appId<span class="token operator">:</span> res<span class="token punctuation">.</span>result<span class="token punctuation">.</span>appId<span class="token punctuation">,</span>  <span class="token comment">//小程序appid</span>
  timeStamp<span class="token operator">:</span> res<span class="token punctuation">.</span>result<span class="token punctuation">.</span>timeStamp<span class="token punctuation">,</span>  <span class="token comment">//生产的时间戳</span>
  nonceStr<span class="token operator">:</span> res<span class="token punctuation">.</span>result<span class="token punctuation">.</span>nonceStr<span class="token punctuation">,</span>  <span class="token comment">//生成的随机字符</span>
  <span class="token keyword">package</span><span class="token operator">:</span> res<span class="token punctuation">.</span>result<span class="token punctuation">.</span>package<span class="token punctuation">,</span>	 <span class="token comment">//prepay_id</span>
  signType<span class="token operator">:</span> res<span class="token punctuation">.</span>result<span class="token punctuation">.</span>signType<span class="token punctuation">,</span>	<span class="token comment">//加密方式，与统一下单时的一致</span>
  paySign<span class="token operator">:</span> res<span class="token punctuation">.</span>result<span class="token punctuation">.</span>sign<span class="token punctuation">,</span>		<span class="token comment">//二次签名，由后端基上面五个参数算出来的</span>
  <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;支付成功&quot;</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;success:&quot;</span> <span class="token operator">+</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    uni<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      title<span class="token operator">:</span> <span class="token string">&quot;支付成功&quot;</span><span class="token punctuation">,</span>
      duration<span class="token operator">:</span> <span class="token number">3000</span><span class="token punctuation">,</span>
      icon<span class="token operator">:</span> <span class="token string">&quot;none&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      uni<span class="token punctuation">.</span><span class="token function">switchTab</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        url<span class="token operator">:</span> <span class="token string">&quot;xxx&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    uni<span class="token punctuation">.</span><span class="token function">showModal</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      content<span class="token operator">:</span> <span class="token string">&quot;支付失败,原因为:\n &quot;</span> <span class="token operator">+</span> err<span class="token punctuation">.</span>errMsg<span class="token punctuation">,</span>
      showCancel<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;fail:&quot;</span> <span class="token operator">+</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="_4-遇到的报错坑"><a href="#_4-遇到的报错坑" class="header-anchor">#</a> （4）遇到的报错坑</h5> <p><strong>调用支付JSAPI缺少参数: total_fee</strong>  ==&gt;</p> <p>说明一定是第三步里提交的参数有问题，特别注意<u><strong>package</strong></u>参数，要以 “prepay_id=xxxxxxxxxx” 的形式发送</p> <p>或者是参数的大小写问题</p> <p><strong>支付验证签名失败</strong>  ==&gt;</p> <p>这是签名的问题，通常是第二次生成的签名不对，可以用官方的校验工具检查一下<a href="https://pay.weixin.qq.com/wiki/doc/api/jsapi.php?chapter=20_1" target="_blank" rel="noopener noreferrer">签名校验在线工具<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>二次签名方式一定要与统一下单接口使用的一致，比如均为MD5</p> <p>注意二次签名的<strong>变量名的大小写</strong>为小驼峰型，与下面的文档保持一致，否则生成的paySign不对</p> <p><img src="/syy-notes/assets/img/wxpay.e9f478ad.png" alt="image-20210418234652030"></p> <p><a href="https://blog.csdn.net/weixin_30684743/article/details/97202700" target="_blank" rel="noopener noreferrer">网上参考教程<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h5 id="_5-其他未尝试的办法"><a href="#_5-其他未尝试的办法" class="header-anchor">#</a> （5）其他未尝试的办法</h5> <p>uniapp提供了一种封装好的unipay插件模板，只需要将小程序的 AppID，商户号，商户密钥等等参数传入，</p> <p>通过云函数，unipay.initWeixin会帮助你生成最终提供给前端的参数</p> <p>同理，小程序云开发也提供了同种功能，但是因为云开发需要付费，未曾尝试过。。。</p> <h2 id="三、动态计算显示高度"><a href="#三、动态计算显示高度" class="header-anchor">#</a> 三、动态计算显示高度</h2> <h5 id="_1-获取手机型号"><a href="#_1-获取手机型号" class="header-anchor">#</a> 1.获取手机型号</h5> <div class="language-js extra-class"><pre class="language-js"><code>uni<span class="token punctuation">.</span><span class="token function">getsystemInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><h5 id="_2-获取节点高度"><a href="#_2-获取节点高度" class="header-anchor">#</a> 2.获取节点高度</h5> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//获取节点信息</span>
uni<span class="token punctuation">.</span><span class="token function">createSelectorQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">in</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">&quot;#one&quot;</span><span class="token punctuation">)</span>
<span class="token comment">//根据节点高度与页面滚动距离scrollTop得到所需滑动的距离</span>
    <span class="token punctuation">.</span><span class="token function">boundingClientRect</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        uni<span class="token punctuation">.</span><span class="token function">pageScrollTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            duration<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
            scrollTop<span class="token operator">:</span> that<span class="token punctuation">.</span>scrollTop <span class="token operator">+</span> data<span class="token punctuation">.</span>top<span class="token operator">-</span><span class="token number">44</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>
</code></pre></div><h2 id="四、scroll吸附贴顶效果"><a href="#四、scroll吸附贴顶效果" class="header-anchor">#</a> 四、scroll吸附贴顶效果</h2> <h4 id="方法1-监听onpagescroll事件-滚动到指定位置添加fixed样式"><a href="#方法1-监听onpagescroll事件-滚动到指定位置添加fixed样式" class="header-anchor">#</a> 方法1. 监听<code>onPageScroll</code>事件，滚动到指定位置添加fixed样式</h4> <p>在Vue中，监听滚动事件，打印当前的<code>scrollTop</code>
首先，在mounted钩子中给window添加一个滚动滚动监听事件，</p> <div class="language-vue extra-class"><pre class="language-vue"><code>mounted () {
  window.addEventListener('scroll', this.handleScroll)
},
</code></pre></div><p>然后在方法中，添加这个<code>handleScroll</code>方法
监听元素到顶部的距离 并判断滚动的距离如果大于了元素到顶部的距离时，设置<code>searchBar</code>为true,否则就是false</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">handleScroll</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> scrollTop <span class="token operator">=</span> window<span class="token punctuation">.</span>pageYOffset <span class="token operator">||</span> document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>scrollTop <span class="token operator">||</span> document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>scrollTop
  <span class="token keyword">var</span> offsetTop <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#searchBar'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>offsetTop
  <span class="token keyword">if</span> <span class="token punctuation">(</span>scrollTop <span class="token operator">&gt;</span> offsetTop<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>searchBarFixed <span class="token operator">=</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>searchBarFixed <span class="token operator">=</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>先写一个该元素固定到顶部的样式，<code>isFixed</code>
然后将需要固定的元素的class与<code>searchBar</code>进行绑定，如果<code>searchBar</code>为true时，就应用这个<code>isFixed</code>样式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;searchBar&quot;</span> id<span class="token operator">=</span><span class="token string">&quot;searchBar&quot;</span><span class="token operator">&gt;</span>
</code></pre></div><p>注意，如果离开该页面需要移除这个监听的事件，不然会报错。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">destroyed</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'scroll'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleScroll<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>存在问题：获取指定位置错误，因为上面都是图片，在图片未加载出来时获取高度， 高度值不对，解决办法就是在<code>imgae</code>上加<code>bindload</code>事件，在图片加载加载完成之后再获取高度； <code>onPageScroll</code>事件会有延迟，导致最终效果会出现卡顿</p> <hr> <h4 id="方法2-通过position-sticky"><a href="#方法2-通过position-sticky" class="header-anchor">#</a> 方法2. 通过<code>position:sticky</code></h4> <p>该元素并不脱离文档流，仍然保留元素原来在文档流中的位置；
当元素在容器中被滚动超过指定的偏移值时，元素就会固定到容器的指定位置，也就是说如果元素设置设置<code>top:50px</code>那么在sticky元素滚动到距离相对定位元素的顶部<code>50px</code>时固定，不再向上移动；
元素固定的相对偏移是相对于离他最近的具有滚动框的祖先元素，如果祖先元素都没有滚动框，那么就是相对于<code>viewport</code>来计算元素的偏移量</p> <p><strong>tip：需要考虑父元素的高度的情况，sticky元素在到达父元素的底部时，则不会再发生定位，如果父元素并没有比sticky元素高，那么sticky元素一开始就到达了底部，就不会有定位的效果，当元素滚动到父元素的底部时sticky属性失效，如果父元素的overflow属性不是默认的visible，那么sticky属性不会生效</strong></p> <p>兼容性不是很好，只支持<code>FireFox</code>和<code>Safari</code>，移动端</p> <h2 id="五、小程序生成海报图片并保存至本地"><a href="#五、小程序生成海报图片并保存至本地" class="header-anchor">#</a> 五、小程序生成海报图片并保存至本地</h2> <p>这里的痛点在于，uniapp和小程序不能直接操作DOM元素，所以一开始想使用 html2canvas ，不能实现</p> <p>尝试其他方法：</p> <h4 id="方法1-使用原生canvas-api直接绘制图片-最原始的方法"><a href="#方法1-使用原生canvas-api直接绘制图片-最原始的方法" class="header-anchor">#</a> 方法1.  使用原生canvas API直接绘制图片（最原始的方法）</h4> <p>但即使最原始的方法，依旧存在一些踩坑，譬如微信小程序官方在2.9.0开始支持了一个canvas 2D的新API，之前的API不再进行维护，因此之后使用canvas的项目，都建议使用canvas 2D来绘制</p> <p>canvas 常用api和 canvas 2D用法 <a href="../css/canvas">跳转这里</a></p> <p>那么canvas2D 有哪些变化呢</p> <ul><li><p>全面支持源生H5 JS的写法，迁移H5代码更容易，学习成本更低</p></li> <li><p>性能上的优化和提升，复杂动画上帧数明显</p></li> <li><p>BUG修复，以及一些不支持的条件完善</p></li></ul> <h4 id="方法2-使用插件"><a href="#方法2-使用插件" class="header-anchor">#</a> 方法2.  使用插件</h4> <h5 id="_1-painter"><a href="#_1-painter" class="header-anchor">#</a> 1.painter</h5> <p>painter git地址：https://github.com/Kujiale-Mobile/Painter
可以在这个演示地址 https://lingxiaoyi.github.io/painter-custom-poster 先布局好，然后复制代码</p> <p>具体使用步骤：
1.下载painter 将components文件下的 painter 文件复制到自己的项目里，然后再使用的页面进行引入
注意：第三方框架编写的小程序需要放到 wxcomponents或者static文件下，默认会报错
不能放在</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">&quot;usingComponents&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
	 <span class="token string">&quot;painter&quot;</span><span class="token operator">:</span><span class="token string">&quot;/wxcomponents/painter/painter&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果使用时遇到这个问题，regeneratorRuntime is not defined，解决方案：勾选增强编译 即可</p> <p>2.在页面中使用</p> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token operator">&lt;</span>painter customStyle<span class="token operator">=</span><span class="token string">'width:630rpx; height: 732rpx;'</span> <span class="token operator">:</span>palette<span class="token operator">=</span><span class="token string">&quot;canvasdata&quot;</span> <span class="token operator">:</span>dancePalette<span class="token operator">=</span><span class="token string">&quot;canvasdata&quot;</span> @imgOK<span class="token operator">=</span><span class="token string">&quot;onImgOK&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">return</span><span class="token punctuation">{</span>
		canvasdata<span class="token operator">:</span><span class="token string">''</span><span class="token punctuation">,</span>
		canvasImgUrl<span class="token operator">:</span><span class="token string">''</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>设置动态数据</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">onSelect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//设置数据的方法，内容较少仅举例方便理解</span>
				<span class="token keyword">var</span> _this <span class="token operator">=</span> <span class="token keyword">this</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>canvasdata <span class="token operator">=</span> <span class="token punctuation">{</span>
		 		width<span class="token operator">:</span><span class="token string">&quot;630rpx&quot;</span><span class="token punctuation">,</span>
				height<span class="token operator">:</span><span class="token string">&quot;732rpx&quot;</span><span class="token punctuation">,</span>
				background<span class="token operator">:</span><span class="token string">'#fff'</span><span class="token punctuation">,</span>
				views<span class="token operator">:</span><span class="token punctuation">[</span>
					<span class="token punctuation">{</span>
						type<span class="token operator">:</span> <span class="token string">'image'</span><span class="token punctuation">,</span>
						url<span class="token operator">:</span> _this<span class="token punctuation">.</span>DetailData<span class="token punctuation">.</span>avatar<span class="token punctuation">,</span>
						css<span class="token operator">:</span> <span class="token punctuation">{</span>
							width<span class="token operator">:</span> <span class="token string">'78rpx'</span><span class="token punctuation">,</span>
							height<span class="token operator">:</span> <span class="token string">'78rpx'</span><span class="token punctuation">,</span>
							borderRadius<span class="token operator">:</span> <span class="token string">'39rpx'</span><span class="token punctuation">,</span>
							top<span class="token operator">:</span> <span class="token string">'30rpx'</span><span class="token punctuation">,</span>
							left<span class="token operator">:</span> <span class="token string">'30rpx'</span><span class="token punctuation">,</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span><span class="token punctuation">,</span>
					<span class="token punctuation">{</span>
					    <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span>
					    <span class="token string">&quot;text&quot;</span><span class="token operator">:</span>  _this<span class="token punctuation">.</span>DetailData<span class="token punctuation">.</span>nickname<span class="token punctuation">,</span>
					    <span class="token string">&quot;css&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
					        <span class="token string">&quot;color&quot;</span><span class="token operator">:</span> <span class="token string">&quot;#434343&quot;</span><span class="token punctuation">,</span>
					        <span class="token string">&quot;width&quot;</span><span class="token operator">:</span> <span class="token string">&quot;200rpx&quot;</span><span class="token punctuation">,</span>
					        <span class="token string">&quot;top&quot;</span><span class="token operator">:</span> <span class="token string">&quot;28rpx&quot;</span><span class="token punctuation">,</span>
					        <span class="token string">&quot;left&quot;</span><span class="token operator">:</span> <span class="token string">&quot;128rpx&quot;</span><span class="token punctuation">,</span>
							<span class="token string">&quot;fontSize&quot;</span><span class="token operator">:</span> <span class="token string">&quot;28rpx&quot;</span>
					    <span class="token punctuation">}</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">]</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>3.保存图片</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">onImgOK</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">// console.log(e)</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>canvasImgUrl <span class="token operator">=</span> e<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>path
<span class="token punctuation">}</span>
<span class="token function">savePoster</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">//保存海报</span>
		<span class="token keyword">var</span> _this <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
		uni<span class="token punctuation">.</span><span class="token function">saveImageToPhotosAlbum</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
		  filePath<span class="token operator">:</span> _this<span class="token punctuation">.</span>canvasImgUrl<span class="token punctuation">,</span>
		  <span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			uni<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			  title<span class="token operator">:</span> <span class="token string">'图片保存成功'</span><span class="token punctuation">,</span>
			  icon<span class="token operator">:</span> <span class="token string">'none'</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
		  <span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
</code></pre></div><h5 id="_2-小程序原生内置扩展组件-wxml-to-canvas"><a href="#_2-小程序原生内置扩展组件-wxml-to-canvas" class="header-anchor">#</a> 2.小程序原生内置扩展组件，<a href="https://developers.weixin.qq.com/miniprogram/dev/extended/component-plus/wxml-to-canvas.html" target="_blank" rel="noopener noreferrer"> wxml-to-canvas <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h5> <p>正常原生小程序开发，如果要增加扩展组件wxml-to-canvas</p> <p>只需要 npm install --save wxml-to-canvas,后面再增加JSON组件声明，wxml引入组件即可</p> <p>执行之后，会在项目根目录下创建node_modules目录，但是这个node_modules 目录不会参与小程序编译、上传和打包，所以要通过开发者工具“工具-构建 npm”，这样就会在node_modules 的同级目录下会生成一个 miniprogram_npm 目录，里面会存放构建打包后的 npm 包，也就是小程序真正使用的 npm 包。</p> <p>但是uniapp开发的小程序不一样，首先uniapp项目里会有自己的package.json文件，安装npm install之后，会在项目根目录生成一个node_modules目录，里面是所有第三方的安装包，包括uniapp的所有包，核心、编译、解析等等。</p> <p>经过uniapp打包之后，生成的原生小程序项目（也就是我们最终给开发者工具使用的项目包），里面是不包含node_modules目录，也就没办法通过开发者工具“工具-构建 npm”生成miniprogram_npm 目录</p> <h5 id="解决方案是"><a href="#解决方案是" class="header-anchor">#</a> 解决方案是</h5> <p>下载官方wxml-to-canvas的代码片段</p> <p>我们在目录里找到miniprogram_npm目录，里面包含三个已经打包好的文件，分别是eventemitter3、widget-ui、wxml-to-canvas</p> <p>我们将其中两个个文件widget-ui、wxml-to-canvas拷贝下来，放到我们的uniapp项目里</p> <p>widget-ui文件放到wxcomponents/widget-ui/miniprogram_npm/widget-ui</p> <p>wxml-to-canvas文件放到wxcomponents/wxml-to-canvas/miniprogram_npm/wxml-to-canvas</p> <p>然后在全局引入wxml-to-canvas</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">&quot;usingComponents&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;wxml-to-canvas&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/wxcomponents/wxml-to-canvas/miniprogram_npm/wxml-to-canvas/index&quot;</span><span class="token punctuation">,</span>
 <span class="token punctuation">}</span>
</code></pre></div><p>另外需要修改wxml-to-canvas/index.js</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../../../widget-ui/miniprogram_npm/widget-ui/index&quot;</span><span class="token punctuation">)</span>
</code></pre></div><h5 id="_3-除此之外还有uni版本的-html-to-canvas插件-请自行搜索"><a href="#_3-除此之外还有uni版本的-html-to-canvas插件-请自行搜索" class="header-anchor">#</a> 3.除此之外还有uni版本的 html-to-canvas插件，请自行搜索~</h5></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2021/5/11 下午5:04:12</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/syy-notes/vue/diff.html" class="prev">
        Vue3
      </a></span> <span class="next"><a href="/syy-notes/git/">
        Git
      </a>
      →
    </span></p></div>  <div id="gitalk-container"></div></main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/syy-notes/assets/js/app.21b87ce3.js" defer></script><script src="/syy-notes/assets/js/2.866f3439.js" defer></script><script src="/syy-notes/assets/js/4.18169195.js" defer></script><script src="/syy-notes/assets/js/11.801c2fb3.js" defer></script><script src="/syy-notes/assets/js/5.9e51e156.js" defer></script>
  </body>
</html>