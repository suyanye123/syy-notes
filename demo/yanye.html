<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>言叶之庭 | 前端小札</title>
    <meta name="description" content="">
    <script>
      var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?8092fab2f2adfc7938ba5b8885aef5b4";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
      })();
    </script>
    <link rel="icon" href="/syy-notes/favicon.ico">
    <link rel="manifest" href="/syy-notes/manifest.json">
    <link rel="apple-touch-icon" href="/syy-notes/favicon.ico">
    <link rel="mask-icon" href="/syy-notes/favicon.ico" color="#3eaf7c">
    <meta name="description" content="前端常用知识、踩坑记录等">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/favicon.ico">
    <meta name="msapplication-TileColor" content="#000000">
    <link rel="preload" href="/syy-notes/assets/css/0.styles.fa044e56.css" as="style"><link rel="preload" href="/syy-notes/assets/js/app.218d4bc3.js" as="script"><link rel="preload" href="/syy-notes/assets/js/2.669adcb6.js" as="script"><link rel="preload" href="/syy-notes/assets/js/5.112ab975.js" as="script"><link rel="preload" href="/syy-notes/assets/js/3.3bf12d48.js" as="script"><link rel="preload" href="/syy-notes/assets/js/6.117958ab.js" as="script"><link rel="prefetch" href="/syy-notes/assets/js/10.64fdab0d.js"><link rel="prefetch" href="/syy-notes/assets/js/11.48253d3d.js"><link rel="prefetch" href="/syy-notes/assets/js/12.52a18985.js"><link rel="prefetch" href="/syy-notes/assets/js/13.5971b759.js"><link rel="prefetch" href="/syy-notes/assets/js/14.a0a9988d.js"><link rel="prefetch" href="/syy-notes/assets/js/15.fc23f409.js"><link rel="prefetch" href="/syy-notes/assets/js/16.5386e44a.js"><link rel="prefetch" href="/syy-notes/assets/js/17.8c4b45fc.js"><link rel="prefetch" href="/syy-notes/assets/js/18.0cf3d6ad.js"><link rel="prefetch" href="/syy-notes/assets/js/19.d471f1ff.js"><link rel="prefetch" href="/syy-notes/assets/js/20.e513e31f.js"><link rel="prefetch" href="/syy-notes/assets/js/21.8bf9554e.js"><link rel="prefetch" href="/syy-notes/assets/js/22.bf76a898.js"><link rel="prefetch" href="/syy-notes/assets/js/23.3e4a6bb9.js"><link rel="prefetch" href="/syy-notes/assets/js/24.d936a030.js"><link rel="prefetch" href="/syy-notes/assets/js/25.947e5ffb.js"><link rel="prefetch" href="/syy-notes/assets/js/26.46c7f3e5.js"><link rel="prefetch" href="/syy-notes/assets/js/27.7ddefcaa.js"><link rel="prefetch" href="/syy-notes/assets/js/28.e82ded5d.js"><link rel="prefetch" href="/syy-notes/assets/js/29.3e593e59.js"><link rel="prefetch" href="/syy-notes/assets/js/30.b7340f43.js"><link rel="prefetch" href="/syy-notes/assets/js/31.71640ed0.js"><link rel="prefetch" href="/syy-notes/assets/js/32.b317d899.js"><link rel="prefetch" href="/syy-notes/assets/js/33.33029ab1.js"><link rel="prefetch" href="/syy-notes/assets/js/34.a4b0511b.js"><link rel="prefetch" href="/syy-notes/assets/js/35.4e7bf53e.js"><link rel="prefetch" href="/syy-notes/assets/js/36.bd03c3f7.js"><link rel="prefetch" href="/syy-notes/assets/js/37.fa74ee64.js"><link rel="prefetch" href="/syy-notes/assets/js/38.b2b3a126.js"><link rel="prefetch" href="/syy-notes/assets/js/39.eec58eb0.js"><link rel="prefetch" href="/syy-notes/assets/js/4.8890886c.js"><link rel="prefetch" href="/syy-notes/assets/js/40.787d9a52.js"><link rel="prefetch" href="/syy-notes/assets/js/41.4b0a0f4a.js"><link rel="prefetch" href="/syy-notes/assets/js/42.d29d9c65.js"><link rel="prefetch" href="/syy-notes/assets/js/43.571e6ee3.js"><link rel="prefetch" href="/syy-notes/assets/js/44.54948254.js"><link rel="prefetch" href="/syy-notes/assets/js/45.48cf9744.js"><link rel="prefetch" href="/syy-notes/assets/js/46.873d0d5d.js"><link rel="prefetch" href="/syy-notes/assets/js/47.04d2aa28.js"><link rel="prefetch" href="/syy-notes/assets/js/48.03c9caaf.js"><link rel="prefetch" href="/syy-notes/assets/js/49.3d40c96a.js"><link rel="prefetch" href="/syy-notes/assets/js/50.23261b7f.js"><link rel="prefetch" href="/syy-notes/assets/js/51.a47e5363.js"><link rel="prefetch" href="/syy-notes/assets/js/7.29e53c95.js"><link rel="prefetch" href="/syy-notes/assets/js/8.4151eb9c.js"><link rel="prefetch" href="/syy-notes/assets/js/9.9ef922c1.js">
    <link rel="stylesheet" href="/syy-notes/assets/css/0.styles.fa044e56.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/syy-notes/" class="home-link router-link-active"><!----> <span class="site-name">前端小札</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工作项目" class="dropdown-title"><span class="title">工作项目</span> <span class="arrow down"></span></button> <button type="button" aria-label="工作项目" class="mobile-dropdown-title"><span class="title">工作项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="http://admin.yuke520.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  后台管理系统
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="/syy-notes/uniapp/yukexcx.html" class="nav-link">
  裕客商城小程序
</a></li></ul></div></div><div class="nav-item"><a href="https://yu-nan.gitee.io/suui" target="_blank" rel="noopener noreferrer" class="nav-link external">
   suUI 
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://www.syy123.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  言叶之庭
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关于" class="dropdown-title"><span class="title">关于</span> <span class="arrow down"></span></button> <button type="button" aria-label="关于" class="mobile-dropdown-title"><span class="title">关于</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/suyanye123/syy-notes" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="/syy-notes/introduce/" class="nav-link">
  关于我
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工作项目" class="dropdown-title"><span class="title">工作项目</span> <span class="arrow down"></span></button> <button type="button" aria-label="工作项目" class="mobile-dropdown-title"><span class="title">工作项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="http://admin.yuke520.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  后台管理系统
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="/syy-notes/uniapp/yukexcx.html" class="nav-link">
  裕客商城小程序
</a></li></ul></div></div><div class="nav-item"><a href="https://yu-nan.gitee.io/suui" target="_blank" rel="noopener noreferrer" class="nav-link external">
   suUI 
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://www.syy123.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  言叶之庭
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关于" class="dropdown-title"><span class="title">关于</span> <span class="arrow down"></span></button> <button type="button" aria-label="关于" class="mobile-dropdown-title"><span class="title">关于</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/suyanye123/syy-notes" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="/syy-notes/introduce/" class="nav-link">
  关于我
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/syy-notes/mytools/" class="sidebar-link">网页工具</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/syy-notes/demo/" class="sidebar-heading clickable router-link-active open"><span>我的项目</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/syy-notes/demo/vuepress.html" class="sidebar-link">前端小札</a></li><li><a href="/syy-notes/demo/yanye.html" aria-current="page" class="active sidebar-link">言叶之庭</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/syy-notes/demo/yanye.html#服务器" class="sidebar-link">服务器</a></li><li class="sidebar-sub-header"><a href="/syy-notes/demo/yanye.html#虚拟机教程" class="sidebar-link">虚拟机教程</a></li><li class="sidebar-sub-header"><a href="/syy-notes/demo/yanye.html#更多" class="sidebar-link">更多</a></li></ul></li><li><a href="/syy-notes/demo/suUI.html" class="sidebar-link">suUI</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/syy-notes/mix/" class="sidebar-heading clickable"><span>混合开发</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/syy-notes/git/" class="sidebar-link">Git</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/syy-notes/webGL/" class="sidebar-heading clickable"><span>WebGL</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/syy-notes/utils/" class="sidebar-heading clickable"><span>utils</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/syy-notes/freeTalk/" class="sidebar-heading clickable"><span>写点东西</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="言叶之庭"><a href="#言叶之庭" class="header-anchor">#</a> 言叶之庭</h1> <p>这里主要是我个人服务器部署，以及搭建动态网站的点点滴滴记录</p> <p>大部分涉及到的是运维相关知识~</p> <h2 id="服务器"><a href="#服务器" class="header-anchor">#</a> 服务器</h2> <p>操作系统主要为 ubuntu 18.04 LTS，ubuntu操作较为简便，且可以安装图形化版本，适合个人，CentOS（redhat社区版）更适合做大服务器  <a href="https://www.centos.org/centos-linux/" target="_blank" rel="noopener noreferrer">centOS下载<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>这里不多做解释相关Linux基础知识 ，如果看不懂，请看本章后半段 <strong>虚拟机教程</strong></p> <p>常用开放端口，比如80(web)、443(https)、21(ftp)、22(ssh)、3306(mysql)等</p> <h3 id="一、使用docker构建-vue-应用镜像"><a href="#一、使用docker构建-vue-应用镜像" class="header-anchor">#</a> 一、使用docker构建 Vue 应用镜像</h3> <h4 id="获取-nginx-镜像"><a href="#获取-nginx-镜像" class="header-anchor">#</a> 获取 Nginx 镜像</h4> <div class="language- extra-class"><pre class="language-text"><code>service docker start  //记得启动docker
docker pull nginx
</code></pre></div><ul><li><p>Docker镜像（Image）一个特殊的文件系统。Docker 镜像是一个特殊的文件系统，除了提供容器运行时所需的程序、库、资源、配置等文件外，还包含了一些为运行时准备的一些配置参数（如匿名卷、环境变量、用户等）。 镜像不包含任何动态数据，其内容在构建之后也不会被改变。</p></li> <li><p>Docker 镜像名称由 REPOSITORY 和 TAG 组成 [REPOSITORY[:TAG]]，TAG默认为 latest。</p></li></ul> <h4 id="创建-nginx-config配置文件"><a href="#创建-nginx-config配置文件" class="header-anchor">#</a> 创建 Nginx Config配置文件</h4> <p>在项目根目录下创建 nginx 文件夹，该文件夹下新建文件 default.conf：</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token keyword">server</span> <span class="token punctuation">{</span>
<span class="token keyword">listen</span>       <span class="token number">80</span><span class="token punctuation">;</span>
<span class="token keyword">server_name</span>  localhost<span class="token punctuation">;</span>

<span class="token comment">#charset koi8-r;</span>
<span class="token keyword">access_log</span>  <span class="token operator">/</span>var<span class="token operator">/</span>log<span class="token operator">/</span>nginx<span class="token operator">/</span>host<span class="token punctuation">.</span>access<span class="token punctuation">.</span>log  main<span class="token punctuation">;</span>
<span class="token keyword">error_log</span>  <span class="token operator">/</span>var<span class="token operator">/</span>log<span class="token operator">/</span>nginx<span class="token operator">/</span>error<span class="token punctuation">.</span>log  error<span class="token punctuation">;</span>

<span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">{</span>
    <span class="token keyword">root</span>   <span class="token operator">/</span>usr<span class="token operator">/</span>share<span class="token operator">/</span>nginx<span class="token operator">/</span>html<span class="token punctuation">;</span>
    <span class="token keyword">index</span>  <span class="token keyword">index</span><span class="token punctuation">.</span>html <span class="token keyword">index</span><span class="token punctuation">.</span>htm<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">#error_page  404              /404.html;</span>
    <span class="token comment">#redirect server error pages to the static page /50x.html</span>
<span class="token comment">#</span>
<span class="token keyword">error_page</span>   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  <span class="token operator">/</span><span class="token number">50</span>x<span class="token punctuation">.</span>html<span class="token punctuation">;</span>
<span class="token keyword">location</span> <span class="token operator">=</span> <span class="token operator">/</span><span class="token number">50</span>x<span class="token punctuation">.</span>html <span class="token punctuation">{</span>
    <span class="token keyword">root</span>   <span class="token operator">/</span>usr<span class="token operator">/</span>share<span class="token operator">/</span>nginx<span class="token operator">/</span>html<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span> 
</code></pre></div><p>该配置文件定义了首页的指向为 /usr/share/nginx/html/index.html，所以我们可以一会把构建出来的 index.html 文件和相关的静态资源放到 /usr/share/nginx/html 目录下。</p> <h4 id="创建-dockerfile-文件"><a href="#创建-dockerfile-文件" class="header-anchor">#</a> 创建 Dockerfile 文件</h4> <p><a href="./docker">怎么新建Dockerfile文件</a></p> <div class="language-nginx extra-class"><pre class="language-nginx"><code>FROM nginx
COPY dist<span class="token operator">/</span> <span class="token operator">/</span>usr<span class="token operator">/</span>share<span class="token operator">/</span>nginx<span class="token operator">/</span>html<span class="token operator">/</span>
COPY nginx<span class="token operator">/</span>default<span class="token punctuation">.</span>conf <span class="token operator">/</span>etc<span class="token operator">/</span>nginx<span class="token operator">/</span>conf<span class="token punctuation">.</span>d<span class="token operator">/</span>default<span class="token punctuation">.</span>conf
</code></pre></div><ul><li>自定义构建镜像的时候基于 Dockerfile 来构建。</li> <li>FROM nginx 命令的意思该镜像是基于 nginx:latest 镜像而构建的。</li> <li>COPY dist/ /usr/share/nginx/html/ 命令的意思是将项目根目录下 dist 文件夹下的所有文件复制到镜像中 /usr/share/nginx/html/ 目录下。</li> <li>COPY nginx/default.conf /etc/nginx/conf.d/default.conf 命令的意思是将 Nginx 目录下的 default.conf 复制到 etc/nginx/conf.d/default.conf，用本地的 default.conf 配置来替换 Nginx 镜像里的默认配置。</li></ul> <h4 id="基于该-dockerfile-构建-vue-应用镜像"><a href="#基于该-dockerfile-构建-vue-应用镜像" class="header-anchor">#</a> 基于该 Dockerfile 构建 Vue 应用镜像</h4> <p>运行命令（注意不要少了最后的 “.” ）：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>docker build -t vuenginxcontainer <span class="token builtin class-name">.</span>
</code></pre></div><p>-t 是给镜像命名，. 是基于当前目录的 Dockerfile 来构建镜像。
<img src="/syy-notes/assets/img/1.35073d10.png" alt="1" style="zoom:45%;"></p> <p>查看本地镜像，运行命令：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>docker image <span class="token function">ls</span> <span class="token operator">|</span> <span class="token function">grep</span> vuenginxcontainer
</code></pre></div><p><img src="/syy-notes/assets/img/2.bff2b793.png" alt="2"></p> <p>到此时我们的 Vue 应用镜像 vuenginxcontainer 已经成功创建。</p> <p>接下来，我们基于该镜像启动一个 Docker 容器。</p> <h4 id="启动-vue-app-容器"><a href="#启动-vue-app-容器" class="header-anchor">#</a> 启动 Vue app 容器</h4> <p>Docker 容器Container： 镜像运行时的实体。镜像（Image）和容器（Container）的关系，就像是面向对象程序设计中的类和实例一样，镜像是静态的定义，容器是镜像运行时的实体。容器可以被创建、启动、停止、删除、暂停等 。</p> <p>基于 vuenginxcontainer 镜像启动容器，运行命令：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>docker run <span class="token punctuation">\</span>
-p <span class="token number">3000</span>:80 <span class="token punctuation">\</span>
-d --name vueApp <span class="token punctuation">\</span>
vuenginxcontainer
</code></pre></div><ul><li>docker run 基于镜像启动一个容器</li> <li>-p 3000:80 端口映射，将宿主的3000端口映射到容器的80端口</li> <li>-d 后台方式运行</li> <li>--name 容器名，查看 Docker 进程</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>docker <span class="token function">ps</span>   //显示所有容器
</code></pre></div><p><img src="/syy-notes/assets/img/3.0dadc6a1.png" alt="3"></p> <p>可以发现名为 vueApp 的容器已经运行起来。此时访问 http://localhost:3000 应该就能访问到该 Vue 应用：
<img src="/syy-notes/assets/img/4.d7f0bc90.png" alt="4"></p> <p>目前为止，已经通过 Docker 容器部署了一个静态资源服务，可以访问到静态资源文件。</p> <p>*<strong>注意如果用了vue-router的history模式，要配个默认主页防止nginx或者其他服务端找不到路由直接报404。vue的dockerfile在官方文档里是有示例</strong></p> <h3 id="二、使用docker构建node容器"><a href="#二、使用docker构建node容器" class="header-anchor">#</a> 二、使用docker构建Node容器</h3> <p>再部署一个 Node 的容器来提供接口服务。</p> <h4 id="express-服务"><a href="#express-服务" class="header-anchor">#</a> Express 服务</h4> <p>用 Node.js web 框架 Express 来写一个服务，注册一个返回 json 数据格式的路由 Server.js：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token string">'use strict'</span><span class="token punctuation">;</span>

const express <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

const PORT <span class="token operator">=</span> <span class="token number">8080</span><span class="token punctuation">;</span>
const HOST <span class="token operator">=</span> <span class="token string">'0.0.0.0'</span><span class="token punctuation">;</span>

const app <span class="token operator">=</span> express<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app.get<span class="token punctuation">(</span><span class="token string">'/'</span>, <span class="token punctuation">(</span>req, res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
res.send<span class="token punctuation">(</span><span class="token string">'Hello world<span class="token entity" title="\n">\n</span>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app.get<span class="token punctuation">(</span><span class="token string">'/json'</span>, <span class="token punctuation">(</span>req, res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
res.json<span class="token punctuation">(</span><span class="token punctuation">{</span>
    code: <span class="token number">0</span>,
    data <span class="token builtin class-name">:</span><span class="token string">'This is message from node container'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app.listen<span class="token punctuation">(</span>PORT, HOST<span class="token punctuation">)</span><span class="token punctuation">;</span>
console.log<span class="token punctuation">(</span><span class="token variable"><span class="token variable">`</span>Running on http://$<span class="token punctuation">{</span>HOST<span class="token punctuation">}</span>:$<span class="token punctuation">{</span>PORT<span class="token punctuation">}</span><span class="token variable">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>运行该 Express 应用需要 Node 环境，我们基于 Node 镜像来构建一个新镜像。</p> <h4 id="获取-node-镜像"><a href="#获取-node-镜像" class="header-anchor">#</a> 获取 Node 镜像</h4> <div class="language-bash extra-class"><pre class="language-bash"><code>docker pull node
</code></pre></div><h4 id="编写-dockerfile-将-express-应用-docker-化"><a href="#编写-dockerfile-将-express-应用-docker-化" class="header-anchor">#</a> 编写 Dockerfile 将 Express 应用 Docker 化</h4> <div class="language-bash extra-class"><pre class="language-bash"><code>FROM node

WORKDIR /usr/src/app

COPY package*.json ./

RUN <span class="token function">npm</span> <span class="token function">install</span>

COPY <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span>

EXPOSE <span class="token number">8080</span>
CMD <span class="token punctuation">[</span> <span class="token string">&quot;npm&quot;</span>, <span class="token string">&quot;start&quot;</span> <span class="token punctuation">]</span>
</code></pre></div><p>构建镜像的时候 node_modules 的依赖直接通过 RUN npm install 来安装，项目中创建一个 .dockerignore文件来忽略一些直接跳过的文件：</p> <div class="language- extra-class"><pre class="language-text"><code>node_modules
npm-debug.log
</code></pre></div><h4 id="构建-nodewebserver-镜像"><a href="#构建-nodewebserver-镜像" class="header-anchor">#</a> 构建 NodeWebServer 镜像</h4> <p>运行构建命令：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>docker build -t nodewebserver <span class="token builtin class-name">.</span>
</code></pre></div><h4 id="启动-nodeserver-容器"><a href="#启动-nodeserver-容器" class="header-anchor">#</a> 启动 NodeServer 容器</h4> <p>基于刚刚构建的 NodeWebServer 镜像 启动一个名为 NodeServer 的容器来提供接口服务8080端口，并映射宿主的5000端口：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>docker run <span class="token punctuation">\</span>
-p <span class="token number">5000</span>:8080 <span class="token punctuation">\</span>
-d --name nodeserver <span class="token punctuation">\</span>
nodewebserver
</code></pre></div><p>查看当前 Docker 进程：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>docker <span class="token function">ps</span>
</code></pre></div><p><img src="/syy-notes/assets/img/5.2d5a9f5c.png" alt="5"></p> <p>可以发现 NodeServer 的容器也正常的运行起来。访问以下 http://localhost:5000/json 能访问到前面写的 json 数据。</p> <img src="/syy-notes/assets/img/6.1f096b85.png" alt="6" style="zoom:67%;"> <p>到目前为止，后端接口服务也正常启动了。只需最后把页面请求的接口转发到后端接口服务就能调通接口。</p> <h3 id="跨域转发"><a href="#跨域转发" class="header-anchor">#</a> 跨域转发</h3> <p>想要将 vueApp 容器 上的请求转发到 NodeServer 容器上。首先需要知道 NodeServer 容器的 IP 地址和端口，目前已知 NodeServer 容器内部服务监听在 8080 端口，还需要知道 IP 即可。</p> <h4 id="查看-nodeserver-容器的-ip-地址"><a href="#查看-nodeserver-容器的-ip-地址" class="header-anchor">#</a> 查看 NodeServer 容器的 IP 地址</h4> <p>查看容器内部 IP 有多种方式，这里提供两种：</p> <p>1、进入容器内部查看：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>docker exect -it 02277acc3efc <span class="token function">bash</span>
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">cat</span> /etc/hosts
</code></pre></div><img src="/syy-notes/assets/img/7.b2ae74c3.png" alt="7" style="zoom:67%;"> <p>2、docker inspect [ containerId ] 直接查看容器信息：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>docker inspect 02277acc3efc
</code></pre></div><p>在其中找到 Networks 相关配置信息：</p> <img src="/syy-notes/assets/img/8.a2ff7d7a.png" alt="8"> <p>记录下 Node 服务容器对应的 IP，一会儿配置 Nginx 转发的时候会用到。</p> <h4 id="修改-nginx-配置"><a href="#修改-nginx-配置" class="header-anchor">#</a> 修改 Nginx 配置</h4> <p>Nginx 配置 Location 指向 Node 服务 default.conf （前端想要了解的Nginx，关于 Nginx 的配置已经 Location 的具体写法可以参考《<a href="https://juejin.im/post/5cbe89b6f265da0373718707" target="_blank" rel="noopener noreferrer">一文弄懂 Nginx 的 Location 匹配<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>》）。</p> <p>添加一条重写规则，将 /api/{path} 转到目标服务的 /{path} 接口上。
在前面的 nginx/default.conf 文件中加入：</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token keyword">location</span> <span class="token operator">/</span>api<span class="token operator">/</span> <span class="token punctuation">{</span>
<span class="token keyword">rewrite</span>  <span class="token operator">/</span>api<span class="token operator">/</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">)</span>  <span class="token operator">/</span>$<span class="token number">1</span>  <span class="token keyword">break</span><span class="token punctuation">;</span>
<span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">172.17</span><span class="token number">.0</span><span class="token number">.2</span><span class="token punctuation">:</span><span class="token number">8080</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> 
</code></pre></div><p>修改完了之后意识到一个问题：vueApp 容器是基于 vuenginxcontainer 这个镜像运行的，而在一开始构建镜像的时候是将 Nginx 配置 default.conf 直接构建进去了。因此如果需要修改 default.conf 还得再重新构建一个新的镜像，再基于新镜像来运行新的容器。</p> <h3 id="改进"><a href="#改进" class="header-anchor">#</a> 改进</h3> <p>能不能每次修改配置文件后直接重启容器就能让新配置生效，答案当然是有。</p> <p>在构建镜像的时候 不把 Nginx 配置复制到镜像中，而是直接挂载到宿主机上，每次修改配置后，直接重启容器即可。</p> <h4 id="修改-dockerfile-文件"><a href="#修改-dockerfile-文件" class="header-anchor">#</a> 修改 Dockerfile 文件</h4> <p>把 vueclidemo 项目下的 Dockerfile 修改一下：</p> <div class="language-dockerfile extra-class"><pre class="language-dockerfile"><code><span class="token keyword">FROM</span> nginx
<span class="token keyword">COPY</span> dist/  /usr/share/nginx/html/
<span class="token keyword">COPY</span> nginx/default.conf /etc/nginx/conf.d/default.conf
</code></pre></div><p>将 COPY nginx/default.conf /etc/nginx/conf.d/default.conf 命令删除，Nginx 配置都通过挂载命令挂载在宿主机上。再看 COPY dist/ /usr/share/nginx/html/ 命令，如果每次构建的项目 dist/ 下的内容变动都需要重新走一遍构建新镜像再启动新容器的操作，因此这条命令也可以删除，使用挂载的方式来启动容器。</p> <h4 id="重新运行-vue-应用容器"><a href="#重新运行-vue-应用容器" class="header-anchor">#</a> 重新运行 Vue 应用容器</h4> <p>直接基于 Nginx 镜像来启动容器 vuenginxnew，运行命令：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>docker run <span class="token punctuation">\</span>
-p <span class="token number">3000</span>:80 <span class="token punctuation">\</span>
-d --name vuenginxnew <span class="token punctuation">\</span>
--mount <span class="token assign-left variable">type</span><span class="token operator">=</span>bind,source<span class="token operator">=</span><span class="token environment constant">$HOME</span>/SelfWork/docker/vueclidemo/nginx,target<span class="token operator">=</span>/etc/nginx/conf.d <span class="token punctuation">\</span>
--mount <span class="token assign-left variable">type</span><span class="token operator">=</span>bind,source<span class="token operator">=</span><span class="token environment constant">$HOME</span>/SelfWork/docker/vueclidemo/dist,target<span class="token operator">=</span>/usr/share/nginx/html <span class="token punctuation">\</span>
nginx
</code></pre></div><ul><li>--mount type=bind,source={sourceDir},target={targetDir} 将宿主机的 sourceDir 挂载到容器的 targetDir 目录上。</li> <li>此处运行的命令较长，如果每次重新输入难免麻烦，我们可以将完整的命令保存到一个 shell 文件 vueapp.sh 中，然后直接执行 sh vueapp.sh。</li></ul> <p>这样就能每次修改了 Nginx 配置或者重新构建了 Vue 应用的时候，只需重启容器就能立马生效。</p> <p>此时我们再访问 http://localhost:3000/api/json 能看到接口能正常返回，说明转发生效了。</p> <p><img src="/syy-notes/assets/img/9.4c2e1feb.png" alt="9"></p> <p>至此接口服务的转发也调通了。</p> <h4 id="配置负载均衡"><a href="#配置负载均衡" class="header-anchor">#</a> 配置负载均衡</h4> <p>后端服务一般都是双机或者多机以确保服务的稳定性。我们可以再启动一个后端服务容器，并修改 Nginx 的配置来优化资源利用率，最大化吞吐量，减少延迟，确保容错配置。</p> <p>基于前面『启动 Vue app 容器』章节的类似操作，新启动一个容器，并基于『Express 服务』章节类似的操作，查看到新容器的 IP（172.17.0.3）。</p> <p>修改一下 nginx/default.conf（新增 upstream ，修改 location /api/ 中的 proxy_pass）：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>upstream backend <span class="token punctuation">{</span>
  server <span class="token number">172.17</span>.0.2:8080<span class="token punctuation">;</span>
  server <span class="token number">172.17</span>.0.3:8080<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

……

location /api/ <span class="token punctuation">{</span>
  rewrite  /api/<span class="token punctuation">(</span>.*<span class="token punctuation">)</span>  /<span class="token variable">$1</span>  <span class="token builtin class-name">break</span><span class="token punctuation">;</span>
  proxy_pass backend<span class="token punctuation">;</span>
<span class="token punctuation">}</span> 
</code></pre></div><h4 id="写在后面"><a href="#写在后面" class="header-anchor">#</a> 写在后面</h4> <p>不习惯命令行的同学可以选用 Kitematic 来管理 Docker 容器的状态、数据目录和网络。所有对容量的操作都可以可视化的操作，这里就不做过多介绍了，有兴趣的同学可以自行体验下。</p> <p><a href="https://juejin.cn/post/6844903837774397447" target="_blank" rel="noopener noreferrer">参考原文<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://blog.51cto.com/dadonggg/1957691" target="_blank" rel="noopener noreferrer"><strong>更多：JAVA项目如何通过Docker实现持续部署</strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="三、宿主机配置nginx搭建多端口站点"><a href="#三、宿主机配置nginx搭建多端口站点" class="header-anchor">#</a> 三、宿主机配置nginx搭建多端口站点</h3> <h4 id="安装nginx"><a href="#安装nginx" class="header-anchor">#</a> <a href="./nginx">安装nginx</a></h4> <h4 id="配置nginx的配置文件nginx-conf"><a href="#配置nginx的配置文件nginx-conf" class="header-anchor">#</a> 配置nginx的配置文件nginx.conf</h4> <p>如果你项目上要两个或者多个vue项目 可以直接在你的80端口下新加一个location
也可以新开一个端口 也就是新建一个serve</p> <p><img src="/syy-notes/assets/img/nginx.4c34c5ea.jpg" alt="nginx"></p> <h4 id="安全配置-参照文章"><a href="#安全配置-参照文章" class="header-anchor">#</a> 安全配置 <a href="https://juejin.cn/post/6966171037713219614#heading-28" target="_blank" rel="noopener noreferrer">参照文章<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h4> <h5 id="禁用server-tokens项"><a href="#禁用server-tokens项" class="header-anchor">#</a> 禁用server_tokens项</h5> <div class="language- extra-class"><pre class="language-text"><code>server {    listen 192.168.1.250:80;    
			Server_tokens off;    
			server_name mingongge.com www.mingongge.com;    
            access_log /var/www/logs/mingongge.access.log;    
            error_log /var/www/logs/mingonggex.error.log error;    
            root /var/www/mingongge.com/public_html;    
            index index.html index.htm;
        }
#server_tokens在打开的情况下会使404页面显示Nginx的当前版本号,重启Nginx后生效

</code></pre></div><h5 id="禁止非法的http-user-agents"><a href="#禁止非法的http-user-agents" class="header-anchor">#</a> 禁止非法的HTTP User Agents</h5> <div class="language- extra-class"><pre class="language-text"><code>include /etc/nginx/blockuseragents.rules;并加入if语句设置阻止后进入的页面：
</code></pre></div><h5 id="禁掉不需要的-http-方法"><a href="#禁掉不需要的-http-方法" class="header-anchor">#</a> 禁掉不需要的 HTTP 方法</h5> <div class="language- extra-class"><pre class="language-text"><code>if ($request_method !~ ^(GET|HEAD|POST)$) {    return 444;}
</code></pre></div><h5 id="禁止-ssl-并且只打开-tls"><a href="#禁止-ssl-并且只打开-tls" class="header-anchor">#</a> 禁止 SSL 并且只打开 TLS</h5> <div class="language- extra-class"><pre class="language-text"><code>ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
</code></pre></div><h4 id="启动nginx"><a href="#启动nginx" class="header-anchor">#</a> 启动nginx</h4> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> usr/local/nginx/sbin

./nginx
</code></pre></div><h4 id="查看nginx服务是否启动成功"><a href="#查看nginx服务是否启动成功" class="header-anchor">#</a> 查看nginx服务是否启动成功</h4> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">ps</span> -ef <span class="token operator">|</span> <span class="token function">grep</span> nginx
</code></pre></div><h4 id="平滑重启nginx服务"><a href="#平滑重启nginx服务" class="header-anchor">#</a> 平滑重启nginx服务</h4> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /usr/local/nginx/sbin	//nginx安装目录

./nginx -s reload
</code></pre></div><hr> <h2 id="虚拟机教程"><a href="#虚拟机教程" class="header-anchor">#</a> 虚拟机教程</h2> <h3 id="_1-新建centos7-虚拟机"><a href="#_1-新建centos7-虚拟机" class="header-anchor">#</a> 1.新建centOS7 虚拟机</h3> <p><img src="/syy-notes/assets/img/centos.18697def.png" alt="image-20210510131501899"></p> <p><code>ping 127.0.0.1</code>    然后   <code>ping www.baidu.com</code>	测试虚拟机能否正常联网</p> <p>如果百度ping不通，说明没有IP或者你没有启用联网功能，此时请更改网络配置文件</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">vi</span> /etc/sysconfig/network-scripts/ifcfg-ens33  //用vi编辑器打开网络配置文件
<span class="token assign-left variable">ONBOOT</span><span class="token operator">=</span>no-----<span class="token operator">&gt;</span>ONBOOT<span class="token operator">=</span>yes	//修改这一项，即 开机启动该网卡
<span class="token function">service</span> network restart		//网络重启
</code></pre></div><p>关于vim编辑器的使用： 打开后按a或者i才能进入编辑模式，编辑完后按esc退出编辑模式，变成命令模式，然</p> <p>​	后再输入：即可跳转至末行，最后输入x命令即可保存。</p> <p>#注：<code>vi /etc/sysconfig/network-scripts/ifcfg-ens33</code>   网络配置文件名可能会有不同，在输入到ifcfg时，可以连续按两下tab键，获取提示，比如我的机器 为 ifcfg-ens33</p> <p>完整网络配置内容如下：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token assign-left variable">TYPE</span><span class="token operator">=</span>Ethernet
<span class="token assign-left variable">BOOTPROTO</span><span class="token operator">=</span>static              <span class="token comment">#静态连接</span>
<span class="token assign-left variable">NAME</span><span class="token operator">=</span>ens33
<span class="token assign-left variable">UUID</span><span class="token operator">=</span>1f093d71-07de-4ca5-a424-98e13b4e9532 
<span class="token assign-left variable">DEVICE</span><span class="token operator">=</span>ens33 
<span class="token assign-left variable">ONBOOT</span><span class="token operator">=</span>yes                    <span class="token comment">#网络设备开机启动 </span>
<span class="token assign-left variable">IPADDR</span><span class="token operator">=</span><span class="token number">192.168</span>.0.101          <span class="token comment">#192.168.59.x, x为3~255. </span>
<span class="token assign-left variable">NETMASK</span><span class="token operator">=</span><span class="token number">255.255</span>.255.0         <span class="token comment">#子网掩码 </span>
<span class="token assign-left variable">GATEWAY</span><span class="token operator">=</span><span class="token number">192.168</span>.66.2          <span class="token comment">#网关IP</span>
<span class="token assign-left variable">DNS1</span><span class="token operator">=</span> <span class="token number">192.168</span>.66.2
</code></pre></div><h3 id="_2-远程连接及建立ftp"><a href="#_2-远程连接及建立ftp" class="header-anchor">#</a> 2.远程连接及建立ftp</h3> <h4 id="xshell连接虚拟机"><a href="#xshell连接虚拟机" class="header-anchor">#</a> Xshell连接虚拟机</h4> <p>在虚拟机中输入 <code>ifconfig</code>，显示虚拟机ip地址</p> <p>然后在Xshell中新建会话，ssh协议，22端口，输入虚拟机root账号密码，即可维持连接登录</p> <h4 id="安装vsftpd-ftp服务端-或xftp"><a href="#安装vsftpd-ftp服务端-或xftp" class="header-anchor">#</a> 安装vsftpd（ftp服务端） 或Xftp</h4> <div class="language-bash extra-class"><pre class="language-bash"><code>yum <span class="token function">install</span> -y vsftpd  //安装vsftp服务端
<span class="token function">vim</span> /etc/vsftpd/vsftpd.conf  //修改vsftp配置
<span class="token assign-left variable">anonymous_enable</span><span class="token operator">=</span>NO		//不允许匿名访问
<span class="token assign-left variable">local_enable</span><span class="token operator">=</span>YES		//允许使用本地帐户进行FTP用户登录验证
</code></pre></div><p>安装好vsftpd后，发现root用户怎么都访问不了ftp</p> <p>修改以下两个文件，将其中的root字段删除</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">vi</span> /etc/vsftpd/ftpusers
<span class="token function">vi</span> /etc/vsftpd/user_list
</code></pre></div><p>然后重启vsftpd服务，ok，问题解决。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">service</span> vsftpd restart
</code></pre></div><p><a href="./vsftpd">深入vsftpd配置</a></p> <h4 id="安装filezilla-client-多线程ftp客户端"><a href="#安装filezilla-client-多线程ftp客户端" class="header-anchor">#</a> 安装FileZilla Client（多线程ftp客户端）</h4> <p>根据虚拟机ip地址，添加站点，然后关闭<strong>selinux</strong>限制</p> <p>先运行<code>getsebool -a | grep ftp</code> (查看selinux里有哪些关于ftp的)</p> <div class="language-bash extra-class"><pre class="language-bash"><code>allow_ftpd_anon_write –<span class="token operator">&gt;</span> off
allow_ftpd_full_access –<span class="token operator">&gt;</span> off
allow_ftpd_use_cifs –<span class="token operator">&gt;</span> off
allow_ftpd_use_nfs –<span class="token operator">&gt;</span> off
ftp_home_dir –<span class="token operator">&gt;</span> off
ftpd_connect_db –<span class="token operator">&gt;</span> off
httpd_enable_ftp_server –<span class="token operator">&gt;</span> off
sftpd_anon_write –<span class="token operator">&gt;</span> off
sftpd_enable_homedirs –<span class="token operator">&gt;</span> off
sftpd_full_access –<span class="token operator">&gt;</span> off
sftpd_write_ssh_home –<span class="token operator">&gt;</span> off
tftp_anon_write –<span class="token operator">&gt;</span> off
</code></pre></div><p>接下来我们allow_ftpd_anon_write  、 allow_ftpd_full_access 这两个ON掉。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>setsebool -P allow_ftpd_anon_write on 
setsebool -P allow_ftpd_full_access on
</code></pre></div><p>即可实现文件上传下载</p> <h3 id="_3-配置docker环境"><a href="#_3-配置docker环境" class="header-anchor">#</a> 3.配置Docker环境</h3> <h4 id="docker详细介绍"><a href="#docker详细介绍" class="header-anchor">#</a> <a href="./docker">Docker详细介绍</a></h4> <h4 id="windows版本"><a href="#windows版本" class="header-anchor">#</a> windows版本</h4> <p>如果想在本地windows环境直接使用docker，可以下载 docker桌面版应用，</p> <p>该应用是基于 WSL2（windows的linux子系统），来实现在windows环境即可操作linux命令，同时可以通过vscode远程连接生成的后端linux-docker环境  <a href="https://docs.microsoft.com/zh-cn/windows/wsl/tutorials/wsl-containers" target="_blank" rel="noopener noreferrer">WSL2的Docker远程容器入门<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>但是WSL2需要开启Hyper-V和Device/Credential Guard服务，会造成与VMware冲突，不能启动虚拟机（新版本好像已经解决该冲突）</p> <p>ps：如果已经存在上述冲突问题，可使用如下方法解决</p> <div class="language- extra-class"><pre class="language-text"><code>WIN+R打开运行，然后输入services.msc回车;
找到 HV主机服务，双击打开设置为禁用；
打开Windows PowerShell（管理员）;
运行命令：bcdedit /set hypervisorlaunchtype off；
然后重启
</code></pre></div><p>因为WSL2占用内存较大，我使用的是在VM虚拟机centos系统中直接配置docker环境</p> <h4 id="centos版本"><a href="#centos版本" class="header-anchor">#</a> centOS版本</h4> <p>docker的安装要求64位系统且内核版本大于3.10。所以如果是centos的话，必须安装CentOS7.0或以上版本。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>yum -y update // 全系统的软件版本升级
<span class="token function">uname</span> -r  //3.10.0-1160.el7.x86_64 查看内核版本
yum -y <span class="token function">install</span> <span class="token function">git</span>   //yum安装git,注意：使用yum安装的git在/usr/bin/git下
</code></pre></div><p>安装方法</p> <div class="language-bash extra-class"><pre class="language-bash"><code>yum <span class="token function">install</span> -y yum-utils	//yum安装依赖包工具
yum-config-manager <span class="token punctuation">\</span>		//设置阿里云镜像仓库
    --add-repo <span class="token punctuation">\</span>
    http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
yum makecache fast			//更新yum源后更新索引，生成缓存提高搜索速度，yum clean all可清除
yum <span class="token function">install</span> docker-ce docker-ce-cli containerd.io	//安装docker引擎
systemctl start docker		//启动docker
docker run hello-world		//验证是否可用
docker version		//查看docker版本
</code></pre></div><h4 id="配置centos下阿里云镜像加速"><a href="#配置centos下阿里云镜像加速" class="header-anchor">#</a> 配置centos下阿里云镜像加速</h4> <p>修改daemon配置文件</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">mkdir</span> -p /etc/docker
<span class="token function">tee</span> /etc/docker/daemon.json <span class="token operator">&lt;&lt;-</span><span class="token string">'EOF'
{
  &quot;registry-mirrors&quot;: [&quot;https://ytvgdcuq.mirror.aliyuncs.com&quot;]
}
EOF</span>
systemctl daemon-reload
systemctl restart docker
</code></pre></div><h4 id="卸载docker"><a href="#卸载docker" class="header-anchor">#</a> 卸载docker</h4> <div class="language-bash extra-class"><pre class="language-bash"><code>yum remove docker-ce docker-ce-cli containerd.io	//卸载依赖
<span class="token function">rm</span> -rf /var/lib/docker 		//删除资源
</code></pre></div><h3 id="_4-自助git服务-私人仓库"><a href="#_4-自助git服务-私人仓库" class="header-anchor">#</a> 4.自助git服务，私人仓库</h3> <p>Gogs 轻量级，图形化的git服务，方便不超过5个人的小团队在上面同步下项目，那么gogs就非常好了。安装便捷，托管/issue/wiki都有，使用简单，学习迅速，足够使用</p> <p><a href="./gogs">gogs使用方法</a></p> <p>gitlab 集成比较强的ci/cd功能，也支持自家omnibus懒人包的docker安装，gitlab集成jenkins和自己设置webhook也方便，功能很多。</p> <p>缺点是很重，对运行机器配置有要求，最少需要服务器4G以上运行内存，</p> <h2 id="更多"><a href="#更多" class="header-anchor">#</a> 更多</h2> <p>新手推荐使用： <a href="https://www.bt.cn/" target="_blank" rel="noopener noreferrer">宝塔面板<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>外链：<a href="https://www.zhihu.com/question/20463581/answer/51381121" target="_blank" rel="noopener noreferrer">如何搭建个人独立博客<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h5 id="推荐一些我遇到的觉得好看的个人博客网站"><a href="#推荐一些我遇到的觉得好看的个人博客网站" class="header-anchor">#</a> 推荐一些我遇到的觉得好看的个人博客网站：</h5> <p>MRJU ： https://mrju.cn/</p> <p>蔡 ：http://aka.cjzblog.top/</p> <p>柏荧的博客：http://qiubaiying.vip/</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2021/5/28上午10:07:15</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/syy-notes/demo/vuepress.html" class="prev">
        前端小札
      </a></span> <span class="next"><a href="/syy-notes/demo/suUI.html">
        suUI
      </a>
      →
    </span></p></div>  <div id="gitalk-container"></div></main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/syy-notes/assets/js/app.218d4bc3.js" defer></script><script src="/syy-notes/assets/js/2.669adcb6.js" defer></script><script src="/syy-notes/assets/js/5.112ab975.js" defer></script><script src="/syy-notes/assets/js/3.3bf12d48.js" defer></script><script src="/syy-notes/assets/js/6.117958ab.js" defer></script>
  </body>
</html>