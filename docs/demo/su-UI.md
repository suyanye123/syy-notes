# suUI

## 分层

在 CSS 里我们可以进行简单的分层。

可以把样式按基础样式、基础组件、业务组件和页面样式这几层进行划分

- 基础样式：像水平居中、弹性布局、全屏遮罩和单行超出截断等这些比较固定的由几条 CSS 语句组合出来的样式，就可以单独实现出来，提供给上层组件进行调用。当然在 CSS 里样式的调用可能需要像 Sass、Stylus 这些与编译器来辅助实现，但也可以通过单独的类进行叠加。
- 基础组件：像按钮、图标等这类组件是比基础样式更高一级，已经能完成一定的功能，但这些功能都比较抽象，不涉及具体的业务。
- 业务组件：像列表、地图这类组件就已经和业务是有关联的了，所以业务组件会针对业务类型做一些定制化，比如打车的业务对地图的组件要求比较高，电商类的业务对商品的展示要求比较高，这些业务组件是在基础组件的基础上又上了一层。
- 页面样式：前端应用的最上层就是页面了，每个应用都是由页面组成的。设计的比较好的应用，只需要在页面中引入需要的组件，再加上少量代码做定制化的改动。



根据这种划分，来构建我自己的UI样式库

## 构建项目



## 基础样式

### 字体图标的使用

> 这里使用的是一个免费的字体图标库Font Awesome 。这个字体图标库提供了网页开发中可以用到的大部分图标，本项目中使用的版本是v5.11.2。

[以npm插件形式引入](https://fa5.dashgame.com/#/%E6%96%87%E6%A1%A3/%E4%BD%BF%E7%94%A8%E5%8C%85%E7%AE%A1%E7%90%86%E5%99%A8)

Font Awesome同样提供了npm插件，如果是npm项目，可以直接使用npm安装font-awesome这个插件来使用。这个项目是纯文件形式的，所以无法使用npm插件。在做框架类的项目时，以npm方式安装字体图标文件是最好的，它既可以满足项目封闭的要求，也不会像使用@import方式一样会影响页面的加载速度。用npm方式使用的时候要先安装font-awesome插件：

```
npm install font-awesome@5.11.2 --save
```

### 移动端缩放

```html
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
```


这条语句是移动端最常用的一个meta标签，这个标签是用来配置viewport属性的，viewport就是显示器的可视区域。在移动端浏览器中，为了让PC端的网页在手机上能正常显示，不至于把内容缩的太小，移动端浏览器就会让承载页面的区域大于屏幕的尺寸，这样可以让手机屏幕只显示网页的一部分内容，再通过拖拽和缩放来查看其他区域的内容。这种默认的行为虽然照顾了PC端的网页，但如果一个网页本来就是为移动端设计的，那么它的显示就是有问题的。所以浏览器提供了可以手动指定viewport值的方法，让承载页面的区域和屏幕等宽，并且使用user-scalable指定页面不可以缩放，这样原本为移动端设计的网页就可以正常显示了。





## 基础组件



## 业务组件



## 页面样式



## UI 样式库的集成

> 我们把之前完成的代码进行优化、整合和包装，达到可以在实战项目中直接使用的状态。会涉及到一些基于 nodejs 的工具，并且会使用 shell 脚本来完成一些辅助的工作。

主要包含两部分内容。

第一部分是把我们之前零散的文件打包成一个最终压缩好的文件，提供给传统的项目使用。

### 文件方式的集成

现在这个样式库还存在以下三个问题：

- 使用 @import 引用了太多的文件，会拖慢加载速度，不可能直接用在生产环境。

源文件中都是使用 @import 做的文件引入，我们需要借助工具对 @import 做解析，把零散的文件集合到一个 CSS 文件中。 [参考postcss详解](../css/postcss)

- 没有处理兼容性的问题，要添加兼容性写法。

之前在书写样式的时候，没有写兼容的语句，这里我们要借助工具来解决兼容性问题。 [参考postcss详解](../css/postcss)

- 文件没有压缩，体积会比较大，同样会影响加载速度。

最后要把文件做最小化的压缩，生成 .min.css 的文件提供给别的项目引用。使用的插件是[“cssnano”](../css/postcss)
使用 shell 脚本完成整个集成的过程，减少命令的输入。

### shell脚本的编写

最后一步，我们来写一个 Shell 脚本来记录下前面的命令，免得每次打包都要输入那么一大串的命令。Shell 脚本通常是在Linux 或者 Mac 系统上才能使用的一种命令式语言，但 Windows 上使用 gitbash 这类工具的话也能支持一部分 Shell 命令。我们先在根目录下建一个名为“shell”的目录，然后在里面放一个“build.sh”的文件：

```bash
# 清空dist目录中的旧文件
echo '正在清除原有dist文件...'
rm -rf dist/*.css

# 打包出不压缩的CSS文件my-ui.css
echo '正在生成tuitui-ui.css文件...'
npx postcss src/my-ui.css -o dist/my-ui.css -u postcss-import autoprefixer --no-map 

# 打包出被压缩的CSS文件my-ui.min.css
echo '正在生成my-ui.min.css文件...'
npx postcss src/my-ui.css -o dist/my-ui.min.css -u postcss-import autoprefixer cssnano --no-map 
```

这个脚本很简单，就是顺序执行几条命令：

首先是清空原有的 dist 目录，来避免一些不必要的错误。
然后执行生成 /dist/my-ui.css 文件的命令，就是刚才在解决兼容性问题时用的那条命令。
最后执行生成 /dist/my-ui.min.css 这个压缩文件的命令，也就是上一步我们用过的那条。
制作完这个脚本以后，再想打包项目，就可以直接在项目里调用这个脚本了。可以在项目根目录执行：

```
./shell/build.sh
```



最终会生成下面这两个目标文件：

```bash
/dist/my-ui.min.css
/dist/my-ui.css
```

其中 /dist/my-ui.min.css 就是我们可以在生产环境使用的最终文件。

此外还生成了一个非压缩的 my-ui.css，这个文件和压缩后的文件内容是一样的，只不过没有进行压缩。

生成这个文件是为了可以看到带有格式的最终文件，如果出现问题可以快速定位出问题的地方



### 制作并发布 npm 包

> 把压缩好的目标文件依照 npm 包的规则进行修改，并发布到 npm 源上，提供给一些基于 npm 的项目使用。

在使用 npm 方式集成的时候，我们会利用上一步打包生成的样式文件。

但在前面生成文件的基础上，我们会更改这个项目对字体图标库的依赖方式，以符合 npm 的规范。

在适配完 npm 包后，把做好的 npm 包发布到 npm 官网上。

安装好的 npm 包会被放在项目里的 node_modules 里，我们找一个包来看下它是什么样的结构，以上一节用的 postcss-cli 为例：

<img src="C:\Users\喻楠\AppData\Roaming\Typora\typora-user-images\image-20210904162601616.png" alt="image-20210904162601616" style="zoom: 50%;" />

```js
npm init 项目初始化

//我们之前打包好的样式是使用网络地址来加载依赖文件 font-awesome 的。但在 npm 中，要遵循 npm 的设计规则，在插件里再引用网络地址就不太合适了，所以我们这一步就是要更改项目依赖的引入方式。
//这里我们使用 npm 引入依赖的方式，首先要在新的这个项目中安装 font-awesome 依赖，命令如下

npm i font-awesome@4.7.0 -S 
//-S 参数就是在 dependencies 里记录所安装插件的信息

```

> @ TIps：
> 这里有两个地方要注意下：
> 1、npm工具只能通过js来引入包，不能直接用css引用其他的插件。
> 2、在index.js里引入css文件，这种引用方式只有在像webpack这种可以把CSS当做JS模块来处理的工具里才可以使用。如果是其他情况就要手动的用路径去引用CSS文件。

```markdown
//添加文档说明
# my-ui样式库

## 说明
本插件依赖font-awesome@4.7.0，安装本插件的同时也会安装font-awesome。在使用本UI样式库的时候可以直接引用对应的CSS文件：

import 'font-awesome/css/font-awesome.min.css';
import 'my-ui/css/my-ui.min.css';

同时，本插件已经使用js文件打包了两个css文件，在支持CSS模块的项目里也可以像下面这样直接引用插件：
import 'my-ui';
```

如果要把代码包发布到官方的 npm 源上，要确保我们当前使用 npm 源也是官方的。像淘宝源这些非官方源只支持npm包的下载，但会明确说明不能支持 npm 包的发布。

下来我们检查一下本机用的到底是哪个源，在命令行中输入下面的命令：

`npm config get registry`

如果要改回到官方的源地址，可以直接用命令来切换：

`npm config set registry https://registry.npmjs.org`

这样 npm 源就切换成功了。接下来还要检查下我们要发布的npm包的名称是不是有重复的，可以在npm官网上搜索一下你要发布的包名，如果找不到重名的包，就可以进入发布工作了。

首先要在项目目录里执行下面命令来初始化 npm 用户信息：

`npm adduser`

执行完命令后输入你注册时使用的用户名和密码，另外还要输入一个用于接收消息的电子邮箱地址，都完成后就完成了登录：

这里要注意，只有在第一次发布的时候才需要使用“npm adduser”命令，如果以后再登录，直接使用下面的命令就可以了：

`npm login`

这个命令一执行成功，你的代码就发布到 npm 上了，所以这个操作要稍微慎重一点，确认好代码没有问题了再去执行。发布完成以后，会有一个很简单的提示，这看起来根本不像刚做了一个很手抖的操作。

这样我们的包就发布完了，现在可以直接在其他项目中直接使用 npm下载我们的 UI 样式库了：

如果发现我们发布的版本有问题的话，在 24 小时以内还是可以对发布的版本进行删除。这是因为担心你发布的包被别的项目引用后，如果你删掉会导致使用你 npm 包的项目全都废掉，所以会有个时间限制。这里建议如果不是很严重的问题，最好使用“npm deprecate”命令来标记这个版本是废弃的，而不是去强行删除掉。
------------------------------------------------